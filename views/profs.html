<head>
    <meta charset="UTF-8">
    <link rel="icon" href="../media/engineering.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">    

    <link rel="stylesheet" href="../style.css">
    <title>LINK Lab</title>

    <style>
        #selection, #confirmdiv {
            text-align: center;
        }

    </style>

    <script type="text/javascript">
        function submit() {
            var e = document.getElementById("professors");
            var value = e.value;
            var prof = e.options[e.selectedIndex].text;

            document.getElementById("confirmation").innerHTML = "You have selected " + prof;
            /* var x = document.getElementById("confirmationbutton")
            x.style.visibility = "visible"; */
        }
    </script>
    
   <!-- <script type="text/javascript" src="../ros-functions.js"></script> -->
   <script type="text/javascript" src="../Ohmni-standalone.js"></script>

</head>

<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="../index.html">
            <img src="../media/engineering.png" alt="Logo" width="24" height="24" class="d-inline-block align-text-top">
            Lab Navigator
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../test_ohmni.html">Test Controls</a>
              </li>

            </ul>
          </div>
        </div>
    </nav>

    <div style="padding: 70px;"></div>

    <div id="content" class="card mx-auto" style="width: 800px;">
        <div id="selection" class="cardbody">
            <h1>Which professor would you like to see?</h1>
            <!--<div id="professors" class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Make a selection
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href='#' value="iqbal">Professor Iqbal</a></li>
                    <li><a class="dropdown-item" href='#' value="behl">Professor Behl</a></li>
                    <li><a class="dropdown-item" href='#' value="bezzo">Professor Bezzo</a></li>
                </ul>
            </div>-->
            <select id="professors" name="professors">
                <option value="iqbal">Professor Iqbal</option>
                <option value="behl">Professor Behl</option>
                <option value="bezzo">Professor Bezzo</option>
            </select> 
            <button class="btn btn-primary" onclick="submit()" data-bs-toggle="modal" data-bs-target="#confirmdiv">Submit</button>      
        </div>

        <div id="confirmdiv" class="modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Confirm Choice</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p id="confirmation"></p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="confirmationbutton" onclick="sendgoal(document.getElementById('professors'))">Confirm</button>
                  </div>
                </div>
            </div>

            <!--<h2 id="confirmation"></h2>
            <button id="confirmationbutton" class="btn btn-primary" style="visibility: hidden" onclick="sendgoal(document.getElementById('professors'))">
                Press here to confirm</button>-->
        </div>        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

</body>

<script>
    
console.log("Ohmni here:", Ohmni)

const location_map = new Map();
location_map.set('iqbal', [100,100]);
location_map.set('behl', [200,200]);
location_map.set('bezzo', [300,300]);

// extracts the value of the selection made by user
// sends corresponding move goal
function sendgoal(element) {
    var location = element.value;
    console.log(location);

    lspeed = location_map.get(location)[0];
    rspeed = location_map.get(location)[1];
    console.log("going to " + lspeed + ", " + rspeed);
    Ohmni.move(lspeed, rspeed, 3000);
}
// Convenience helpers

/* function wait(cb, ms) {
  setTimeout(function(){ cb(); }, ms);
}

var lhue = 0;

// Set up the beat here
function upbeat() {

  Ohmni.setNeckPosition(550, 140);
  wait(function(){
    downbeat();
  }, 1000);

}

// Set up the beat here
function downbeat() {

  // Change light on every downbeat
  Ohmni.setLightColor(lhue, 230, 100);
  lhue += 20;
  if (lhue > 255) lhue -= 256;

  // Perform upbeat next
  Ohmni.setNeckPosition(350, 80);
  wait(function(){
    upbeat();
  }, 500);

}


function onPlayerStateChange(event) {
  console.log("Player state change.");
}

// Run a phase sequence
function run_phases(phasearr, idx) {

  // Check if we have something to do
  if (idx >= phasearr.length) return;

  // Get and run the function with a callback to trigger next phase
  var self = this;
  var fn = phasearr[idx];
  fn(function(){
    setTimeout(function(){
      self.run_phases(phasearr, idx+1);
    }, 1);
  });

};

// Wait and then trigger callback
function wait(cb, time) {
  setTimeout(function() {
    cb();
  }, time);
}

function move(lspeed, rspeed, time) {
  var phases = [
    function(cb) {
      Ohmni.move(lspeed, rspeed, time);
      wait(cb, 2000);
    },
  ];
  run_phases(phases, 0);
}

function praise() {
  Ohmni.say("Meo is cool!", function(){
    Ohmni.say("Praise Callback");
  });
}

function requestBotInfo() {
  Ohmni.requestBotInfo();
}

function cbRequestBotInfo(data) {
  console.log('cbRequestBotInfo', data)
  showBotInfo(data);
}

function showBotInfo(data) {
  const dataObject = JSON.parse(data);

  document.querySelector("#bot_info").style.display = "block";
  document.getElementById("bot_name").innerHTML = dataObject.name;
  document.getElementById("bot_id").innerHTML = dataObject.botId;
  document.getElementById("bot_version").innerHTML = dataObject.version;
  document.getElementById("wifi_ssid").innerHTML = dataObject.wifi.ssid;
  document.getElementById("wifi_bssid").innerHTML = dataObject.wifi.bssid;
  document.getElementById("wifi_ip").innerHTML = intToIPV4(dataObject.wifi.ip);
  document.getElementById("wifi_frequency").innerHTML = dataObject.wifi.freq + " MHz";
  document.getElementById("wifi_rssi").innerHTML = dataObject.wifi.rssi + " dBm";
  document.getElementById("wifi_speed").innerHTML = dataObject.wifi.speed + " Mbps";
  document.getElementById("serial").innerHTML = dataObject.serial;

  const shareLinksNode = document.querySelector("#share_links");
  // remove all element
  while (shareLinksNode.firstChild) {
    shareLinksNode.removeChild(shareLinksNode.firstChild);
  }
  const shareLinksElements = Object.keys(dataObject.shareLinks).forEach(element => {
    const shareLink = document.createElement("p");
    const shareLinkNode = document.createTextNode(`Share link : app.ohmnilabs.com/share/${element}`);
    shareLink.appendChild(shareLinkNode);
    shareLinksNode.appendChild(shareLink);
  });
}

function hideBotInfo() {
  document.querySelector("#bot_info").style.display = "none";
}

const intToIPV4 = num => {
  const part1 = num & 255;
  const part2 = (num >> 8) & 255;
  const part3 = (num >> 16) & 255;
  const part4 = (num >> 24) & 255;
  return `${part1}.${part2}.${part3}.${part4}`;
};

function nod() {
  var phases = [
    function(cb) {
      Ohmni.say("Nodding.");
      wait(cb, 800);
    },
    function(cb) {
      Ohmni.setNeckTorqueEnabled(1);
      wait(cb, 800);
    },
    function(cb) {
      Ohmni.setNeckPosition(600, 100);
      wait(cb, 2000);
    },
    function(cb) {
      Ohmni.setNeckPosition(250, 100);
      wait(cb, 2000);
    },
    function(cb) {
      Ohmni.setNeckTorqueEnabled(0);
      wait(cb, 1);
    },
  ];
  run_phases(phases, 0);
}
 */

</script>